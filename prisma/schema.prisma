generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Owner {
  id       String       @id @default(cuid())
  fullName String?
  taxCode  String?      @unique
  address  String?
  emails   OwnerEmail[]
  phones   OwnerPhone[]
  pets     Pet[]        @relation("CurrentOwner")
  links    PetOwner[]   @relation("OwnerLinks")

  @@index([fullName])
}

model OwnerEmail {
  id      String @id @default(cuid())
  email   String
  owner   Owner  @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId String

  @@unique([ownerId, email])
}

model OwnerPhone {
  id      String @id @default(cuid())
  phone   String
  owner   Owner  @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId String

  @@unique([ownerId, phone])
}

model Pet {
  id         String   @id @default(cuid())
  owner      Owner?   @relation("CurrentOwner", fields: [ownerId], references: [id], onDelete: SetNull)
  ownerId    String? // current primary owner
  name       String?
  species    String?
  breed      String?
  sex        String?
  dob        String?
  color      String?
  sterilized Boolean?
  microchip  String?

  visits Visit[]
  owners PetOwner[] @relation("PetLinks")

  @@index([ownerId, name])
  @@index([microchip])
}

model PetOwner {
  id        String  @id @default(cuid())
  pet       Pet     @relation("PetLinks", fields: [petId], references: [id], onDelete: Cascade)
  petId     String
  owner     Owner   @relation("OwnerLinks", fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId   String
  role      String // "primary" | "secondary"
  startDate String?
  endDate   String?
  note      String?

  @@index([petId, ownerId])
  @@index([ownerId])
}

model Visit {
  id                String   @id @default(cuid())
  pet               Pet      @relation(fields: [petId], references: [id], onDelete: Cascade)
  petId             String
  visitedAt         String? // ISO (YYYY-MM-DD)
  description       String
  examsText         String?
  prescriptionsText String?
  rawText           String?
  attachments       String?
  createdAt         DateTime @default(now())
}
